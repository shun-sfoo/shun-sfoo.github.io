# 安全并发

# 通用概念

并发 并行
并发是 **同时应对** 多件事情的能力
并行是 **同时执行** 多件事情的能力

进程是资源分配的最小单元，线程是程序执行时的最小单元

线程有创建，就绪，运行，阻塞，死亡五种状态

## 事件驱动，异步回调，协程

c10k 问题， 事件驱动问题， linux epoll 技术
比如说 node.js 仅仅使用但线程就可以获得强大的
并发处理能力，来源事件驱动和异步回调，通过内置的
事件循环机制，不断地从事件列队中查询是有有事件发生，
当读取到事件时，就会调用此事件相关联的回调函数，整个过程是非阻塞的.
复杂代码，回调地狱

go 程 协程
协程是进一步完善基于事件驱动的编程体验
它为协同任务提供了一种抽象，这种抽象本质上是
控制流的出让和恢复，符合人类异步处理事物的直觉
本来做一件事，来了另外一件事，切换场景完成该事后，回到之前的工作。
协程让开发者用写同步（顺序）代码的方式标写可异步执行的代码.
挖掘了单线程的利用率，单线程下可以处理高并发，但却无法利用多核.

## 线程安全

多线程存在问题主要是因为资源共享，比如共享内存，文件，数据库等，
当一个或多个线程对这些资源进行读写操作才会出问题，
只读不写资源不会发生变化就不会存在安全问题。

### 竞态条件 数据竞争

竞态条件当某个计算的正确性取决于多个线程交替执行的顺序时，就会产生竞态条件
当一个线程写一个变量而另一个线程读这个变量，如果两个线程没有进行同步，就会发生数据竞争。

## 同步，互斥，原子类型

## CSP 并发模型

基本构造是 CSP 进程和通信通道
在 rust 中 线程就是 csp 进程， channel 就是通信通道
具体实现是一个多生产者单消费者的先进先出队列
